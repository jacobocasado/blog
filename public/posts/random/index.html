<!DOCTYPE html>
<html class="" lang="en"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    
        <script>
            if (location.host != new URL("http:\/\/localhost:1313\/").host) location.href = "http:\/\/localhost:1313\/"
        </script>
    
    <meta name="viewport" content="width=device-width" />
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=7" />

    <link
    rel="icon"
    href='http://localhost:1313/favicon.png'
/>
<link
    rel="shortcut icon"
    href='http://localhost:1313/favicon.ico'
    type="image/x-icon"
/>
<link
    rel="apple-touch-icon"
    href='http://localhost:1313/apple-touch-icon.png'
/>

    <link
        rel="icon"
        href='http://localhost:1313/logo.svg'
        type="image/svg+xml"
    />

<title>
        
            Random stuff  &ndash;
        
        purpurina - A place for hacking
    </title>

    
    <link href="http://localhost:1313/symbols-nerd-font/symbols-nerd-font.css" rel="stylesheet" integrity="sha512-lydow8GLOLlYNOtHlksNCmGWWCBsbIEtikXpHzfWqx78HLlyQZHOzyLwPpKol4Th6aCwLUXOfODVYgwrd3nwKQ=="/>
    <link href="http://localhost:1313/jetbrains-mono/jetbrains-mono.css" rel="stylesheet" integrity="sha512-tJxlgL6v1Y7kFf+qB8SloaAMKnOAw6WouknxXtIjkBux9Y/9aX81EUWOJO8c/3l98DmjG8brr4to7zaez606Fg=="/>

    
    
    <link type="text/css" rel="stylesheet" href=http://localhost:1313/css/styles.99a590d8c34d2609c956413487de3640ee3a95e91c0811b15188b7b103ceafa8bcf9febe0db200ad6c1a05177e5f468fdd4cda0f8722653a53d770bc7dbc74c6.css integrity="sha512-maWQ2MNNJgnJVkE0h942QO46lekcCBGxUYi3sQPOr6i8&#43;f6&#43;DbIArWwaBRd&#43;X0aP3UzaD4ciZTpT13C8fbx0xg==" />
<meta name="author" content="jaco" />

    
        <meta name="keywords" content='evasion, firststeps, loader, maldev' />
    
    
        <meta name="description" content="aration. Used when hooking, to get a pointer to the original function to get it dinamically resolved via IAT and then override this pointer, or to craft a new function that points to a shellcode with the function behavior (used in reflective DLL shellcode)
Case of getting the function pointer to a resolving Windows API call:
// Declaring the function pointer to a resolving Windows API call int (WINAPI* pToUnicodeEx) (UINT wVirtKey, UINT wScanCode, const BYTE *lpKeyState, LPWSTR pwszBuff, int cchBuff, UINT wFlags, HKL dwhkl) = ToUnicodeEx; // Call the function using its pointer pToUnicodeEx(wVirtKey, wScanCode, lpKeyState, pwszBuff, cchBuff, wFlags, dwhkl); Case of getting the function pointer to a memory zone where the function is implemented via shellcode:" />
    

<meta property="og:site_name"
    content='purpurina - A place for hacking' />

    <meta property="og:title" content="Random stuff" />
    <meta property="og:type" content="article" />
    
    <meta
        property="article:author" content="jaco" />
    <meta
        property="article:published_time"
        content='2024-02-28T20:53:30Z&#43;0100' />
    
        
            <meta property="article:tag" content="evasion" />
        
            <meta property="article:tag" content="firststeps" />
        
            <meta property="article:tag" content="loader" />
        
            <meta property="article:tag" content="maldev" />
        
    
    <meta property="og:url" content="http://localhost:1313/posts/random/" />
    
    
    <meta property="og:image"
        content="http://localhost:1313/icon512.png" />
    
        <meta property="og:description" content="Custom function declaration. Used when hooking, to get a pointer to the original function to get it dinamically resolved via IAT and then override this pointer," />
    

<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:domain"
      content='localhost:1313'
/>
<meta property="twitter:url" content="http://localhost:1313/posts/random/" />


    <meta name="twitter:title" content="Random stuff" />
    
    
    
    <meta name="twitter:image"
        content="http://localhost:1313/icon512.png" />
    
        <meta name="twitter:description" content="Custom function declaration. Used when hooking, to get a pointer to the original function to get it dinamically resolved via IAT and then override this pointer," />
    

<link rel="manifest" href="http://localhost:1313/manifest/index.json" />
</head>


<body>
        <div id="baseContainer"><header class="">
<div class="titleAndSearchContainer">
        <div id="titleContainer">
            
                <a class="unstyledLink" href="http://localhost:1313/">
                    <img src='http://localhost:1313/logo.jpg' alt='Logo'/>
                </a>
            
            <div class="rightOfLogo">
                <div class="titleAndHamburger">
                    <h1>
                        <a class="unstyledLink" href="http://localhost:1313/">purpurina - A place for hacking</a>
                        
                    </h1>
                    
                </div>
                <div id="wide_nav"><nav>
    
    <ul id="main-nav">
        <li><a href="http://localhost:1313/">Home</a></li>
        
            <li><a href="http://localhost:1313/posts/">Posts</a></li>
        
        
        
        
        
        
            <li><a href="http://localhost:1313/about/">About</a></li>
        
        
            <li><a href="http://localhost:1313/tags/">Tags</a></li>
        
        
    </ul>
</nav>
</div>
            </div>
        </div>
        <div class="search">
    <input id="searchbar" type="text" placeholder='Search' />
    <span class="nerdlink" onclick="newSearch();">&#xf002;</span>
</div>
<script>
    function newSearch() {
        let term = searchbar.value.trim();
        if (!term) return;
        location.href = `/search/?q=${term}`;
    }
    searchbar.onkeyup = (ev) => {if (ev.keyCode == 13) newSearch()};
</script>

    </div>
    <div id="links">
        
        
        <a
    
        rel="noreferrer"
    
    target="_blank"
    class="nerdlink"
    href="https://www.linkedin.com/in/jacobocasado/?originalSubdomain=es">
    
    
        &#xf0e1;
    
    <span>
        LinkedIn
    </span>
</a>

    </div>
    

</header>
<div id="contentContainer">
                <div id="content">
                    <main>
<article class="card single">
    
        <h1>Random stuff</h1>
    
    
        <p class="date">
            <span title='Date'> </span>
    2024-02-28

</p>
    
    
    
    <div class="articleToc">
    <nav id="TableOfContents"></nav>
    <hr />
</div>

    <div><p>Custom function declaration. Used when hooking, to get a pointer to the original function to get it dinamically resolved via IAT and then override this pointer, or to craft a new function that points to a shellcode with the function behavior (used in reflective DLL shellcode)</p>
<p><strong>Case of getting the function pointer to a resolving Windows API call:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#75715e">// Declaring the function pointer to a resolving Windows API call
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> (WINAPI<span style="color:#f92672">*</span> pToUnicodeEx) (UINT wVirtKey,  UINT wScanCode, <span style="color:#66d9ef">const</span> BYTE <span style="color:#f92672">*</span>lpKeyState, LPWSTR pwszBuff, <span style="color:#66d9ef">int</span> cchBuff, UINT wFlags, HKL dwhkl) <span style="color:#f92672">=</span> ToUnicodeEx;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Call the function using its pointer
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>pToUnicodeEx(wVirtKey, wScanCode, lpKeyState, pwszBuff, cchBuff, wFlags, dwhkl);
</span></span></code></pre></div><p><strong>Case of getting the function pointer to a memory zone where the function is implemented via shellcode:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#75715e">// Declaring the function pointer to a resolving Windows API call
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">typedef</span> <span style="color:#a6e22e">DWORD</span> (WINAPI <span style="color:#f92672">*</span> EXECUTEX64)( X64FUNCTION pFunction, DWORD dwParameter );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Declaring the function pointer instance to NULL
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>EXECUTEX64 pExecuteX64   <span style="color:#f92672">=</span> NULL;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Allocating function for the function pointer
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>pExecuteX64 <span style="color:#f92672">=</span> (EXECUTEX64)VirtualAlloc( NULL, <span style="color:#66d9ef">sizeof</span>(sh_executex64), MEM_RESERVE<span style="color:#f92672">|</span>MEM_COMMIT, PAGE_READWRITE );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Copying the shellcode to the function pointer location
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>memcpy( pExecuteX64, sh_executex64, sh_executex64_len );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Call the function using its pointer
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>pExecuteX64( pX64function, (DWORD)ctx );
</span></span></code></pre></div></div>
</article>

    <hr />
    <p class="articleTagsContainer">
        <span> </span>
        <strong>Tags:</strong>
        
            <a
                
                class="buttonTag"
                
                href="http://localhost:1313/tags/evasion/">#evasion</a>
        
            <a
                
                class="buttonTag"
                
                href="http://localhost:1313/tags/firststeps/">#firststeps</a>
        
            <a
                
                class="buttonTag"
                
                href="http://localhost:1313/tags/loader/">#loader</a>
        
            <a
                
                class="buttonTag"
                
                href="http://localhost:1313/tags/maldev/">#maldev</a>
        
    </p>





    
    
        
            
        
        <div class="relatedArticlesContainer">
            <hr />
            <h2>More posts like this</h2>
            <div class="postlist ">
                <article class="card postlistitem">
    <div>
        <h2>
            <a href="http://localhost:1313/posts/firststeps/">My first steps in MalDev</a>
        </h2>
        <p class="date">
            <span title='Date'> </span>
    2024-02-28


                | 
                <span title='Tags'> </span>
                
                    <a href="http://localhost:1313/tags/evasion">#evasion</a>
                
                    <a href="http://localhost:1313/tags/firststeps">#firststeps</a>
                
                    <a href="http://localhost:1313/tags/loader">#loader</a>
                
                    <a href="http://localhost:1313/tags/maldev">#maldev</a>
                
            
        </p>
        
        
            <div class="articlePreview">
                <p>
                    
                        Prelude Around this last month I have been digging into the Malware Development world. I have always wanted to expand my knowledge within this field, and I felt like it was the moment to do so.
As mentioned in many other blogposts, Sektor7 Malware Development Essentials course was a good point to start. Nevertheless, I found this course very short and I felt like most of the important concepts are ignored (e.g., what is a handle?) and are just used like if I already know them.
Because of that, I actually recommend take a little stop on each of the things that the course shows you in order to UNDERSTAND what does each line do and also do some personal research on each of the things that the course provides.
                    
                </p>
                <p><a href="http://localhost:1313/posts/firststeps/">Continue reading </a></p>
            </div>
        
    </div>
    <hr />
</article>
<article class="card postlistitem">
    <div>
        <h2>
            <a href="http://localhost:1313/posts/wow64/">Understanding Heaven Gate</a>
        </h2>
        <p class="date">
            <span title='Date'> </span>
    2024-09-19


                | 
                <span title='Tags'> </span>
                
                    <a href="http://localhost:1313/tags/evasion">#evasion</a>
                
                    <a href="http://localhost:1313/tags/firststeps">#firststeps</a>
                
                    <a href="http://localhost:1313/tags/loader">#loader</a>
                
                    <a href="http://localhost:1313/tags/maldev">#maldev</a>
                
            
        </p>
        
        
            <div class="articlePreview">
                <p>
                    
                        Heaven&rsquo;s gate lore The Heaven&rsquo;s Gate tutorial was written by an anonymous hacker going online as Roy G. Biv, a member of a group called 29A. After the group disbanded and their e-zine&rsquo;s site went down, the Heaven&rsquo;s Gate technique was later reprinted in the 2009 edition of the Valhalla hacker e-zine. I personally would check this resource, as it was the first time the technique was commented.
Why does Heaven&rsquo;s gate exist? In a normal environment, we have 64-bit Windows operative systems (or at least, we expect so). Some detection mechanisms, like antivirus software and OS security features, do not detect a 32-bit process jumps from running 32-bit compatible code to 64-bit code.
                    
                </p>
                <p><a href="http://localhost:1313/posts/wow64/">Continue reading </a></p>
            </div>
        
    </div>
    <hr />
</article>
<article class="card postlistitem">
    <div>
        <h2>
            <a href="http://localhost:1313/posts/shellcodes/">Shellcodes for everything</a>
        </h2>
        <p class="date">
            <span title='Date'> </span>
    2024-02-28


                | 
                <span title='Tags'> </span>
                
                    <a href="http://localhost:1313/tags/lab">#lab</a>
                
                    <a href="http://localhost:1313/tags/maldev">#maldev</a>
                
                    <a href="http://localhost:1313/tags/shellcodes">#shellcodes</a>
                
            
        </p>
        
        
            <div class="articlePreview">
                <p>
                    
                        Shellcodes that will be useful for testing/developing your malware.
I usually work on the same OS and with the same Compiler version for better reproducibility so here are my specs:
Windows 10 Pro 22H2 OS Build 19045.4046 MSVC vc.exe compiler (64-bit and 32-bit) version 19.41.34123 Shellcodes are not encrypted. You should encrypt them if you want evasion, as these shellcodes are public and not crafted manually by me.
64-bit (64-bit) MessageBox unsigned char shellcode[] = { 0xfc, 0x48, 0x81, 0xe4, 0xf0, 0xff, 0xff, 0xff, 0xe8, 0xd0, 0x00, 0x00, 0x00, 0x41, 0x51, 0x41, 0x50, 0x52, 0x51, 0x56, 0x48, 0x31, 0xd2, 0x65, 0x48, 0x8b, 0x52, 0x60, 0x3e, 0x48, 0x8b, 0x52, 0x18, 0x3e, 0x48, 0x8b, 0x52, 0x20, 0x3e, 0x48, 0x8b, 0x72, 0x50, 0x3e, 0x48, 0x0f, 0xb7, 0x4a, 0x4a, 0x4d, 0x31, 0xc9, 0x48, 0x31, 0xc0, 0xac, 0x3c, 0x61, 0x7c, 0x02, 0x2c, 0x20, 0x41, 0xc1, 0xc9, 0x0d, 0x41, 0x01, 0xc1, 0xe2, 0xed, 0x52, 0x41, 0x51, 0x3e, 0x48, 0x8b, 0x52, 0x20, 0x3e, 0x8b, 0x42, 0x3c, 0x48, 0x01, 0xd0, 0x3e, 0x8b, 0x80, 0x88, 0x00, 0x00, 0x00, 0x48, 0x85, 0xc0, 0x74, 0x6f, 0x48, 0x01, 0xd0, 0x50, 0x3e, 0x8b, 0x48, 0x18, 0x3e, 0x44, 0x8b, 0x40, 0x20, 0x49, 0x01, 0xd0, 0xe3, 0x5c, 0x48, 0xff, 0xc9, 0x3e, 0x41, 0x8b, 0x34, 0x88, 0x48, 0x01, 0xd6, 0x4d, 0x31, 0xc9, 0x48, 0x31, 0xc0, 0xac, 0x41, 0xc1, 0xc9, 0x0d, 0x41, 0x01, 0xc1, 0x38, 0xe0, 0x75, 0xf1, 0x3e, 0x4c, 0x03, 0x4c, 0x24, 0x08, 0x45, 0x39, 0xd1, 0x75, 0xd6, 0x58, 0x3e, 0x44, 0x8b, 0x40, 0x24, 0x49, 0x01, 0xd0, 0x66, 0x3e, 0x41, 0x8b, 0x0c, 0x48, 0x3e, 0x44, 0x8b, 0x40, 0x1c, 0x49, 0x01, 0xd0, 0x3e, 0x41, 0x8b, 0x04, 0x88, 0x48, 0x01, 0xd0, 0x41, 0x58, 0x41, 0x58, 0x5e, 0x59, 0x5a, 0x41, 0x58, 0x41, 0x59, 0x41, 0x5a, 0x48, 0x83, 0xec, 0x20, 0x41, 0x52, 0xff, 0xe0, 0x58, 0x41, 0x59, 0x5a, 0x3e, 0x48, 0x8b, 0x12, 0xe9, 0x49, 0xff, 0xff, 0xff, 0x5d, 0x49, 0xc7, 0xc1, 0x00, 0x00, 0x00, 0x00, 0x3e, 0x48, 0x8d, 0x95, 0x1a, 0x01, 0x00, 0x00, 0x3e, 0x4c, 0x8d, 0x85, 0x35, 0x01, 0x00, 0x00, 0x48, 0x31, 0xc9, 0x41, 0xba, 0x45, 0x83, 0x56, 0x07, 0xff, 0xd5, 0xbb, 0xe0, 0x1d, 0x2a, 0x0a, 0x41, 0xba, 0xa6, 0x95, 0xbd, 0x9d, 0xff, 0xd5, 0x48, 0x83, 0xc4, 0x28, 0x3c, 0x06, 0x7c, 0x0a, 0x80, 0xfb, 0xe0, 0x75, 0x05, 0xbb, 0x47, 0x13, 0x72, 0x6f, 0x6a, 0x00, 0x59, 0x41, 0x89, 0xda, 0xff, 0xd5, 0x48, 0x69, 0x20, 0x66, 0x72, 0x6f, 0x6d, 0x20, 0x52, 0x65, 0x64, 0x20, 0x54, 0x65, 0x61, 0x6d, 0x20, 0x4f, 0x70, 0x65, 0x72, 0x61, 0x74, 0x6f, 0x72, 0x21, 0x00, 0x52, 0x54, 0x4f, 0x3a, 0x20, 0x4d, 0x61, 0x6c, 0x44, 0x65, 0x76, 0x00 }; (64-bit) calc.
                    
                </p>
                <p><a href="http://localhost:1313/posts/shellcodes/">Continue reading </a></p>
            </div>
        
    </div>
    <hr />
</article>

            </div>
        </div>
    


                    </main><footer>
    <hr />

<p><small>
        2024 &copy; made by jaco with love
    </small></p>
    <p><small>
        Licensed under <a href='https://www.gnu.org/licenses/agpl-3.0.html'>GNU AGPLv3</a>.
    </small></p>
</footer>
</div>
            </div>
        </div>


</body>
</html>
